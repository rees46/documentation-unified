# Отмена заказа

Отмена заказа возможна в двух случаях:

1. Заказ подтвержден через `checkout/confirm`
2. Заказ оформлен через `checkout/apply`

Отмена выполняет следующие операции:

1. Возмещает потраченные бонусы, стикеры, купоны, промокоды и сертификаты.
2. Отменяет вознаграждения покупателя и реферера.
3. Отменяет выданные купоны.

::: info Важно
Не отменяйте заказ на этапе `checkout/apply`, если клиент, вероятно, решит его оплатить. Статус "отменен" финальный и повторно отправить `apply` с тем же номером заказа не получится. Если клиент просто меняет содержимое корзины, используйте повторный `checkout/apply` с тем же номером заказа.

Но не путайте с `checkout/estimate`: если клиент меняет корзину, но не переходит к оплате, используйте `checkout/estimate`. Метод `checkout/apply` применяйте только тогда, когда клиент зафиксировал корзину и перешел к оплате.
:::

```
POST https://api.rees46.ru/loyalty/checkout/cancel
```

## Параметры

| Параметр    | Обязателен? | Описание           |
|-------------|-------------|--------------------|
| shop_id     | Да          | API-ключ           |
| shop_secret | Да          | Секретный ключ API |
| order_id    | Да          | Номер заказа       |

## Запрос

Пример запроса:

```shell 
curl --header "Content-Type: application/json" \
  --request POST \
  --data-binary "@payload.json" \
  https://api.rees46.ru/loyalty/checkout/cancel
```

Пример JSON-тела:

```json payload.json
{
  "shop_id":        "...",
  "shop_secret":    "...",
  "order_id":       "..."
}
```

## Ответ

Пример ответа сервера:

```json 
{
  "success": true,
  "payload": {
    "order_id": "...",
    "identifier": "..."
  }
}
```

Расшифровка ответа:

| Параметр           | Описание                                                             |
|--------------------|----------------------------------------------------------------------|
| success            | Запрос выполнен успешно или нет                                      |
| payload.message    | Сообщение с результатом обработки запроса                            |
| payload.order_id   | Идентификатор заказа                                                 |
| payload.identifier | Идентификатор участника программы лояльности в формате `7XXXXXXXXXX` |

В случае ошибки данных вернет подобную структуру:

```json 
{
  "success": false,
  "payload": {
    "message": "Could not cancel order in its current status"
  }
}
```
