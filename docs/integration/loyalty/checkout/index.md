# Процессинг и обработка заказов

Данная группа методов API является основной программы лояльности. Методы принимают на вход информацию о покупателей, текущую корзину (или набор услуг), выполняют расчет скидок, вознаграждений покупателя и реферальных партнеров, сертификаты, подписки, промокоды и пр.

Жизненный цикл заказа:

| Метод                                  | Описание                                                                                 |
|----------------------------------------|------------------------------------------------------------------------------------------|
| [`checkout/estimate`](./estimate.md)   | Предварительная оценка скидок и вознаграждений без блокировки бонусов для списания       |
| [`checkout/apply`](./apply.md)         | Зарезервировать бонусы, сертификаты и промокоды, привязать сохранить информацию о заказе |
| [`checkout/confirm`](./confirm.md)     | Подтвердить заказ после оплаты (в рознице) или доставки (онлайн)                         |
| [`checkout/cancel`](./cancel.md)       | Полностью отменить заказ (полный возврат или отмена)                                     |
| [`checkout/change`](./change.md)       | Внесение изменений в подтвержденный заказ (для частичного возврата)                      |

Помимо этого есть ряд вспомогательных методов для работы с заказом:

| Метод                              | Описание                                                      |
|------------------------------------|---------------------------------------------------------------|
| [`checkout/details`](./details.md) | Подробная информация о заказе программы лояльности            |
| [`checkout/history`](./history.md) | История всех заказов программы лояльности конкретного клиента |


### Запрет на скидки, списание и вознаграждение бонусами

Определенные товары могут быть исключены из вознаграждения или применения скидок несколькими способами:

1. Исключение определенных категорий или брендов на странице настроек программы лояльности.
2. Более точное исключение товаров по цене, артикулу, категории и бренду в настройках акции.
3. Точечная блокировка скидок, вознаграждений и списаний бонусов в товарном фиде с помощью свойств:
   - `bonuses_accrual_allowed: false` – явная блокировка вознаграждения бонусов к товару;
   - `bonuses_spending_allowed: false` – явная блокировка списания бонусов к товару;
   - `discounts_allowed: false` – явная блокировка скидок по скидочной ПЛ и скидочных акций;
   ::: info Важно
   Данные флаги имеют высший приоритет после метода в пункте 4, если выставлены в `false` и блокируют действие всех остальных настроек, включая акции.
   :::
4. Точечная блокировка скидок, вознаграждений и списаний бонусов в запросе:
    - `bonusable: false` – явная блокировка вознаграждения бонусов к товару;
    - `discountable: false` – явная блокировка списания бонусов к товару;
    - `rewardable: false` – явная блокировка скидок по скидочной ПЛ и скидочных акций;
      ::: info Важно
      Данные флаги имеют высший приоритет, если выставлены в `false` и блокируют действие всех остальных настроек, включая акции.
      :::