# Отправка одноразового кода 

Чтобы отправлять одноразовые коды, предварительно нужно создать транзакционную рассылку для отправки кода и указать ее в настройках программы лояльности.

Используйте переменную `{{ code }}` для подстановки кода в текст сообщения.

Транзакционная рассылка может быть отправлена на любой канал, в том числе каскадная, а не только SMS. Но поиск клиента в БД для получения других контактов (email, мобильный пуш, Telegram, MAX и пр) будет выполняться только по номеру телефона. 

::: info Обратите внимание
Код будет уходить на любой номер телефона, даже если он не используется как идентификатор в программе лояльности и отсутствует в базе клиентов. При этом, если в CDP отсутствует клиент с таким номером телефона, он будет создан автоматически с указанием источника `loyalty_otp`.
:::

```
POST https://api.rees46.ru/loyalty/otp/send
```

## Параметры

| Параметр          | Обязателен? | Описание                                                |
|-------------------|-------------|---------------------------------------------------------|
| shop_id           | Да          | API-ключ                                                |
| shop_secret       | Да          | Секретный ключ API                                      |
| identifier        | Да          | Номер телефона клиента                                  |
| event             | Да          | Код события (действия), допустимость которого проверяем |

Параметр `event` может быть любой строкой из латинских букв и цифр, а также `_`, которым мы отделяем разные проверки. Для одного номера можно параллельно запускать разные проверки. Например:

- `password_recovery` – отправка кода для восстановления пароля;
- `charge_bonuses` – проверка разрешения списать бонусы;
- и пр, т.е. значение `event` вы придумываете сами.

## Запрос

Пример запроса:

```shell 
curl --header "Content-Type: application/json" \
  --request POST \
  --data-binary "@payload.json" \
  https://api.rees46.ru/loyalty/otp/send
```

Пример JSON-тела:

```json payload.json
{
    "shop_id": "...",
    "shop_secret": "...",
    "identifier": "7XXXXXXXXX",
    "event": "verify_phone"
}
```


## Ответ

Пример ответа сервера:

```json 
{
  "success": true
}
```

В случае ошибки ответ будет в формате:

```json 
{
  "success": false,
  "payload": {
    "message": "Identifier is not valid"
  }
}
```
