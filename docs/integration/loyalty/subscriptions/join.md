# Создание подписки клиента

Первичное создание подписки для клиента. Создает запись в CDP, если ее нет. Если есть, то перезаписывает новыми условиями.

Если придет запрос на создание той же подписки, но с другим тарифным планом, то произойдет переключение подписки на новый тарифный план.

Метод не рекомендуется использовать для продления подписки, так как это может повлиять на расчеты лимитов и отчетность. Для продления подписки без изменения других условий (тариф, дата очистки лимитов), используйте метод [продления подписки](./prolong.md).

```
POST https://api.rees46.ru/loyalty/subscriptions/members/join
```

## Параметры

| Параметр          | Обязателен? | Описание                                                                                                                                                                                                  |
|-------------------|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| shop_id           | Да          | API-ключ                                                                                                                                                                                                  |
| shop_secret       | Да          | Секретный ключ API                                                                                                                                                                                        |
| identifier        | Да          | Номер телефона клиента, идентификатор участника ПЛ                                                                                                                                                        |
| subscription      | Да          | Уникальный код подписки                                                                                                                                                                                   |
| plan              | Да          | Уникальный код плана (тарифа)                                                                                                                                                                             |
| paid_till         | Да          | Дата, до которой оплачена подписка, в формате `YYYY-MM-DD`                                                                                                                                                |
| limits_reset_date | Да          | Дата, в которую будет следующий сброс лимитов, в формате `YYYY-MM-DD`. Дата может отличаться от `paid_till`, если клиент оплатил подписку больше, чем на месяц, а лимиты нужно сбрасывать уже через месяц |

## Запрос

Пример запроса:

```shell 
curl --header "Content-Type: application/json" \
  --request POST \
  --data-binary "@payload.json" \
  https://api.rees46.ru/loyalty/subscriptions/members/join
```

Пример JSON-тела:

```json payload.json
{
    "shop_id": "...",
    "shop_secret": "...",
    "identifier": "7XXXXXXXXX",
    "subscription": "marketplace",
    "plan": "professional",
    "paid_till": "2026-10-01",
    "limits_reset_date": "2026-07-01"
  
}
```


## Ответ

Пример ответа сервера:

```json 
{
  "success": true,
  "payload": {
    "message": "Member is joined to subscription",
    "identifier": "...",
    "subscription": "...",
    "plan": "...",
    "paid_till": "...",
    "limits_reset_date": "..."
  }
}
```

В случае ошибки ответ будет в формате:

```json 
{
  "success": false,
  "payload": {
    "message": "Identifier is not valid"
  }
}
```

Расшифровка ответа:

| Параметр                  | Описание                                                             |
|---------------------------|----------------------------------------------------------------------|
| success                   | Запрос выполнен успешно или нет                                      |
| payload.message           | Сообщение с результатом обработки запроса                            |
| payload.identifier        | Идентификатор участника программы лояльности в формате `7XXXXXXXXXX` |
| payload.subscription      | Уникальный код подписки                                              |
| payload.plan              | Уникальный код плана                                                 |
| payload.paid_till         | Дата, до которой оплачена подписка                                   |
| payload.limits_reset_date | Дата, когда будет выполнен следующий сброс лимитов                   |